<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
		<title>IoMT</title>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
		<style>
			body {
				background-color: #000;
				font-family: 'Open Sans Condensed', sans-serif;
			}
			#title {
				text-align:center;
				font-size: 100px;
				text-weight: bold;
				color: #fff;
			}
			#container {
				background-image: url('https://raw.githubusercontent.com/iomtcam/iomtcam.github.io/master/DSC100626278.jpg');
				background-size: 100% auto;
				background-repeat: no-repeat;
				width: 940px;
				margin: 0px auto;
				padding: 20px;
				border: none;
				background-color: #fff;
				height:90vh;
			}
			#header {
				text-align:center;
				padding: 20px;
				margin-bottom: 15px;
				margin-top:20px;
				border: none;
			}
			#content {
				padding: 20px;
				margin-bottom: 20px;
				border: none;
			}
			table {
				border-radius: 15px;
				width: 100%;
				border: 1px #000;
			}
			th, td {
				height: 40px;
				border-radius: 0px;
				background-color: #fff;
				border: 1px #000;
				padding: 10px;
			}
			#selectCam {
				width: 100%;
				height: 100%;
				border-radius: 15px;
			}
			option {
				height: 100%;
			}
			.menubar{
			border:none;
			border:0px;
			margin:0px;
			padding:0px;
			font-size:30px;
			color: #5b5b5b;
			font-weight:bold;
			}

			.menubar ul{
			background: rgb(109,109,109);
			height:50px;
			list-style:none;
			margin:auto auto;
			padding:0;
			width:60%;
			}

			.menubar li{
			padding:0px;
			width:100%;
			position:relative;
			}

			.menubar li a{
			background: #fff;;
			color:#5b5b5b;
			display:block;
			font-weight:normal;
			line-height:50px;
			margin:0px;
			padding:0px 25px;
			text-align:center;
			text-decoration:none;
			}

			.menubar li a:hover, .menubar ul li:hover a{
			background: #5b5b5b;
			color:#fff;
			text-decoration:none;
			}

			.menubar li ul{
			background: #5b5b5b;
			color: #fff;
			display:none; /* 평상시에는 드랍메뉴가 안보이게 하기 */
			height:auto;
			padding:0px;
			margin:0px;
			border:0px;
			position:relative;
			width:100%;
			z-index:200;
			/*top:1em;
			/*left:0;*/
			}

			.menubar li:hover ul{
				display:block; /* 마우스 커서 올리면 드랍메뉴 보이게 하기 */
			}


			.menubar li li {
			background: #5b5b5b;
			color:#fff;
			display:block;
			float:none;
			margin:0px;
			padding:0px;
			width:100%;
			}

			.menubar li:hover li a{
			background:none;
			}

			.menubar li ul a{
			display:block;
			height:50px;
			font-style:normal;
			margin:0px;
			padding:0px 10px 0px 15px;
			text-align:center;
			}

			.menubar li ul a:hover, .menubar li ul li:hover a{
			background: #ffffff;
			border:0px;
			color:#5b5b5b;
			text-decoration:none;
			}

			.menubar p{
			clear:left;
			}
			
			#selectedContent{
				margin-top: 20px;
				text-align:center;
				font-size: 30px;
				color: #fff;
				border: none;
				opacity: 0;
			}
			
			@keyframes mainContentAnimation {
			  from {
				opacity: 0;
			  }
			  to {
				opacity: 1;
			  }
			}
			
			#videoTime{
				font-family: 'Open Sans Condensed', sans-serif;
				font-size: 30px;
				border: 0px 0px 1px 0px;
				height: 34px;
				color: #fff;
				width: 10%;
				border-color: rgba(0,0,0,0);
				border-bottom-color: #fff;
				-webkit-box-shadow: none;
				box-shadow: none;
				outline: 0;
				background: rgba(0,0,0,0);
				text-align: center;
			}
			#videoTime:focus{
				box-shadow: none;
				-webkit-box-shadow: none;
				outline: none;
			}
			
			button{
			    margin-top: 10px;
				font-family: 'Open Sans Condensed', sans-serif;
				font-weight: bold;
				font-size: 28px;
				padding: 2px;
				border: 1px solid white;
				border-radius: 5px;
				height: 40px;
				color: rgba(0,0,0,0.5);
				-webkit-box-shadow: none;
				box-shadow: none;
				outline: 0;
				background: #fff;
				vertical-align: center;
			}
			button:hover{
				cursor: pointer;
				animation-name: buttonHover;
				animation-duration: 1s;
				animation-iteration-count: infinite;
				
			}
			@keyframes buttonHover{
			  0% {
				color: rgba(0,0,0,0.5);
				background: #fff;
			  }
			  50% {
				color: #fff;
				background: rgba(0,0,0,0.5);
			  }
			  100% {
				color: rgba(0,0,0,0.5);
				background: #fff;
			  }
			}
			
			.pop-layer .pop-container, .pop-layer2 .pop-container2, .pop-layer3 .pop-container3 {
			  padding: 20px 25px;
			}

			.pop-layer p.ctxt{
			  color: #666;
			  line-height: 25px;
			}

			.pop-layer .btn-r, .pop-layer2 .btn-r2, .pop-layer3 .btn-r3{
			  width: 100%;
			  margin: 10px 0 20px;
			  padding-top: 10px;
			  border-top: 1px solid #DDD;
			  text-align: right;
			}

			.pop-layer, .pop-layer2 {
			  display: none;
			  position: absolute;
			  top: 50%;
			  left: 50%;
			  width: 600px;
			  height: auto;
			  background-color: #333333;
			  border: 5px solid #fff;
			  z-index: 10;
			}
			
			.pop-layer3 {
			  display: none;
			  position: absolute;
			  top: 50%;
			  left: 50%;
			  width: 680px;
			  height: auto;
			  background-color: #333333;
			  border: 5px solid #fff;
			  z-index: 10;
			}

			
			.dim-layer, .dim-layer2, .dim-layer3 {
			  display: none;
			  position: fixed;
			  _position: absolute;
			  top: 0;
			  left: 0;
			  width: 100%;
			  height: 100%;
			  z-index: 100;
			}

			.dim-layer .dimBg, .dim-layer2 .dimBg2, .dim-layer3 .dimBg3 {
			  position: absolute;
			  top: 0;
			  left: 0;
			  width: 100%;
			  height: 100%;
			  background: #000;
			  opacity: .5;
			  filter: alpha(opacity=50);
			}

			.dim-layer .pop-layer, .dim-layer2 .pop-layer2, .dim-layer3 .pop-layer3 {
			  display: block;
			}

			a.btn-layerClose, a.btn-layerClose2, a.btn-layerClose3 {
			  margin-left:20px;
			  display: inline-block;
			  height: 30px;
			  padding: 0 14px 0;
			  border: 1px solid #fff;
			  background-color: #fff;
			  font-size: 30px;
			  color: #5b5b5b;
			  line-height: 30px;
			  text-decoration: none;
			}

			a.btn-layerClose:hover, a.btn-layerClose2:hover,, a.btn-layerClose3:hover,{
			  border: 1px solid #5b5b5b;
			  background-color: #5b5b5b;
			  color: #fff;
			}
			a.btn-example{
				border: 2px solid #fff;
				border-radius: 15px;
				color:#fff;
				text-decoration: none;
				padding: 2px;
				margin 4px;
			}
			a.btn-example:link{
				border: 2px solid #fff;
				border-radius: 15px;
				color:#fff;
				text-decoration: none;
				padding: 2px;
				margin 4px;
			}
			a.btn-example:visited{
				border: 2px solid #fff;
				border-radius: 15px;
				color:#fff;
				text-decoration: none;
				padding: 2px;
				margin 4px;
			}
			a.btn-example:hover{
				animation-name: ahover;
				animation-duration: 3s;
				animation-iteration-count: infinite;
				border: 2px solid #fff;
				border-radius: 15px;
				color:#fff;
				text-decoration: none;
				padding: 2px;
				margin 4px;
				cursor: pointer;
			}
			@keyframes ahover{
				0%{
				  background-color: none;
				  color: #fff;
				  border-color: #fff;
				}
				50%{
				   background-color: #fff;
				  color: #5b5b5b;
				  border-color: #5b5b5b;
				}
				100%{
				   background-color: none;
				  color: #fff;
				  border-color: #fff;
				}
			}

        @keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-moz-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-webkit-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-o-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-moz-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-webkit-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @-o-keyframes rotate-loading {
            0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
            100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
        }

        @keyframes loading-text-opacity {
            0%  {opacity: 0}
            20% {opacity: 0}
            50% {opacity: 1}
            100%{opacity: 0}
        }

        @-moz-keyframes loading-text-opacity {
            0%  {opacity: 0}
            20% {opacity: 0}
            50% {opacity: 1}
            100%{opacity: 0}
        }

        @-webkit-keyframes loading-text-opacity {
            0%  {opacity: 0}
            20% {opacity: 0}
            50% {opacity: 1}
            100%{opacity: 0}
        }

        @-o-keyframes loading-text-opacity {
            0%  {opacity: 0}
            20% {opacity: 0}
            50% {opacity: 1}
            100%{opacity: 0}
        }
        .loading-container,
        .loading {
            height: 200px;
            position: relative;
            width: 200px;
            border-radius: 100%;
        }


        .loading-container { margin: 40px auto }
		.loading-container3 { 
			margin-left: auto;
				margin-right: auto;
		}
        .loading {
            border: 4px solid transparent;
            border-color: transparent #fff transparent #FFF;
            -moz-animation: rotate-loading 1.5s linear 0s infinite normal;
            -moz-transform-origin: 50% 50%;
            -o-animation: rotate-loading 1.5s linear 0s infinite normal;
            -o-transform-origin: 50% 50%;
            -webkit-animation: rotate-loading 1.5s linear 0s infinite normal;
            -webkit-transform-origin: 50% 50%;
            animation: rotate-loading 1.5s linear 0s infinite normal;
            transform-origin: 50% 50%;
        }

        .loading-container:hover .loading {
            border-color: transparent #E45635 transparent #E45635;
        }
        .loading-container:hover .loading,
        .loading-container .loading {
            -webkit-transition: all 0.5s ease-in-out;
            -moz-transition: all 0.5s ease-in-out;
            -ms-transition: all 0.5s ease-in-out;
            -o-transition: all 0.5s ease-in-out;
            transition: all 0.5s ease-in-out;
        }

        #loading-text {
            -moz-animation: loading-text-opacity 2s linear 0s infinite normal;
            -o-animation: loading-text-opacity 2s linear 0s infinite normal;
            -webkit-animation: loading-text-opacity 2s linear 0s infinite normal;
            animation: loading-text-opacity 2s linear 0s infinite normal;
            color: #ffffff;
            font-family: "Helvetica Neue, "Helvetica", ""arial";
            font-size: 30px;
            font-weight: bold;
            margin-top: 62px;
            opacity: 0;
            position: absolute;
            text-align: center;
            text-transform: uppercase;
            top: 0;
            width: 200px;
        }
		
		#loading-text2 {
            color: #ffffff;
            font-size: 30px;
            font-weight: bold;
            position: absolute;
            text-align: left;
            top: 0;
            width: 100%;
        }
        .cen {
			margin-left: auto;
			margin-right: auto;
		}

		</style>
	</head>
	<body>
		<div id='container'>
			<div id='header'>
				<span id='title'>IoMT Camera service</span>
			</div>
			<div id='content'>
				<div class="menubar">
				   <ul>
					  <li><a href="#" id="current">Select a camera</a>
						 <ul>
						   <li><a id="cam1" href="#" onclick="cam1Selected();">Campus view</a></li>
						   <li><a id="cam2" href="#" onclick="cam2Selected();">Lab view</a></li>
						 </ul>
					  </li>
				   </ul>
				</div>
				<div id='selectedContent'>
					<span>Thumbnail</span><br>
					<span><img style="-webkit-user-select: none;" id='imgg1' src='http://117.17.158.187:62000/image/jpeg.cgi' width="0%"><img style="-webkit-user-select: none;" id='imgg2' src='http://117.17.158.187:63000/image/jpeg.cgi' width="0%"></span><br>
					<span id='tokenPerSecond'></span><span>MTT per second</span><br>
					<span>I want to watch for</span><input id='videoTime' type="text"><span>seconds</span><br>
					<span>And it costs </span><span id='tokenAmount'> </span><span> MTT</span><br>
					<a class="btn-example">Send Token</a><br>
				</div>
				<div class="dim-layer">
					<div class="dimBg"></div>
					<div id="layer2" class="pop-layer">
						<div class="pop-container">
							<div class="pop-conts">
								<!--content //-->
									<div class="loading-container">
										<div class="loading"></div>
										<div id="loading-text">Sending<br>MTT Token</div>
									</div>
								<!--// content-->
							</div>
						</div>
					</div>
				</div>
				<div class="dim-layer2">
					<div class="dimBg2"></div>
					<div id="layer3" class="pop-layer2">
						<div class="pop-container2">
							<div class="pop-conts2">
								<!--content //-->
									<div class="loading-container2">
										<div id="loading-text2">Please input time as much as you want  <a href="#" class="btn-layerClose2">Close</a></div>
									</div>
								<!--// content-->
							</div>
						</div>
					</div>
				</div>
				<div class="dim-layer3">
					<div class="dimBg3"></div>
					<div id="layer4" class="pop-layer3">
						<div class="pop-container3">
							<div class="pop-conts3">
								<!--content //-->
									<div class="loading-container3">
										 <div class="cen"><img id="screen" style="-webkit-user-select: none;" src='https://raw.githubusercontent.com/iomtcam/iomtcam.github.io/master/black.jpg'/></div>
										 <div class="cen"><button id="wat" onclick="watchVideo()">Watch video</button></div>
									</div>
								<!--// content-->
							</div>
						</div>
					</div>
				</div>
			 </div>
		</div>	
	</body>
	<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<!-- script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script -->
	<script>
		var contractAddress = '0x68a164c76eec4d7b8064d5a1df7e9e931ef95a78';
		var camAddress;
		var abi = [
			{
				"constant": true,
				"inputs": [],
				"name": "name",
				"outputs": [
					{
						"name": "",
						"type": "string"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "spender",
						"type": "address"
					},
					{
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "approve",
				"outputs": [
					{
						"name": "success",
						"type": "bool"
					}
				],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "totalSupply",
				"outputs": [
					{
						"name": "",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "from",
						"type": "address"
					},
					{
						"name": "to",
						"type": "address"
					},
					{
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "transferFrom",
				"outputs": [
					{
						"name": "success",
						"type": "bool"
					}
				],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "decimals",
				"outputs": [
					{
						"name": "",
						"type": "uint8"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [
					{
						"name": "tokenOwner",
						"type": "address"
					}
				],
				"name": "balanceOf",
				"outputs": [
					{
						"name": "balance",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [],
				"name": "acceptOwnership",
				"outputs": [],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "owner",
				"outputs": [
					{
						"name": "",
						"type": "address"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "symbol",
				"outputs": [
					{
						"name": "",
						"type": "string"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "to",
						"type": "address"
					},
					{
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "transfer",
				"outputs": [
					{
						"name": "success",
						"type": "bool"
					}
				],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "spender",
						"type": "address"
					},
					{
						"name": "tokens",
						"type": "uint256"
					},
					{
						"name": "data",
						"type": "bytes"
					}
				],
				"name": "approveAndCall",
				"outputs": [
					{
						"name": "success",
						"type": "bool"
					}
				],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "newOwner",
				"outputs": [
					{
						"name": "",
						"type": "address"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "tokenAddress",
						"type": "address"
					},
					{
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "transferAnyERC20Token",
				"outputs": [
					{
						"name": "success",
						"type": "bool"
					}
				],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [
					{
						"name": "tokenOwner",
						"type": "address"
					},
					{
						"name": "spender",
						"type": "address"
					}
				],
				"name": "allowance",
				"outputs": [
					{
						"name": "remaining",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "_newOwner",
						"type": "address"
					}
				],
				"name": "transferOwnership",
				"outputs": [],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "constructor"
			},
			{
				"payable": true,
				"stateMutability": "payable",
				"type": "fallback"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"name": "_from",
						"type": "address"
					},
					{
						"indexed": true,
						"name": "_to",
						"type": "address"
					}
				],
				"name": "OwnershipTransferred",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"name": "from",
						"type": "address"
					},
					{
						"indexed": true,
						"name": "to",
						"type": "address"
					},
					{
						"indexed": false,
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "Transfer",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"name": "tokenOwner",
						"type": "address"
					},
					{
						"indexed": true,
						"name": "spender",
						"type": "address"
					},
					{
						"indexed": false,
						"name": "tokens",
						"type": "uint256"
					}
				],
				"name": "Approval",
				"type": "event"
			}
		];
		var camAbi;
		var tokenContract;
		var token;
		var camContract;
		var cam;
		var event;
		var openWin;
		var watchTime;
		var blockNum;
		var videoURL;
		var costPerSecond;
		var imageURL1;
		var imageURL2;
		var watchButton=document.getElementById('watchButton');
			
		window.addEventListener('load', function() {
			// Checking if Web3 has been injected by the browser (Mist/MetaMask)
			if (typeof web3 !== 'undefined') {
				// Use Mist/MetaMask's provider
				window.web3 = new Web3(web3.currentProvider);
			} else {
				console.log('No web3? You should consider trying MetaMask!')
				// fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
				window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
			}
				// Now you can start your app & access web3 freely:
				startApp();
		});
			
		function startApp() {
			tokenContract = web3.eth.contract(abi);
			token = tokenContract.at(contractAddress);
			watchTime = 0;
			imageURL1 = 'http://117.17.158.187:62000/image/jpeg.cgi';
			imageURL2 = 'http://117.17.158.187:63000/image/jpeg.cgi';
			<!--watchButton.disabled = 'disabled';-->
			setupUpdater();
			web3.eth.getAccounts(function(e,r){
			getLink(r[0]);
			console.log(r[0]);
  });
			document.getElementsByTagName('input')[0].focus();
		}
		function getLink(addr) {
			return '<a target="_blank" href=https://testnet.etherscan.io/address/' + addr + '>' + addr +'</a>';
		}
		function sendToken(){
			var tokenAmount = Number(document.getElementById('tokenAmount').innerText);
			token.approveAndCall(camAddress,tokenAmount*1000000000,0x000,function(e,r){console.log(r);});
			console.log(tokenAmount*1000000000);
			event.watch(function(e,r){
				console.log(r.args.second.c[0]);
				watchTime = r.args.second.c[0];
				console.log(typeof watchTime);
				var $href = '#layer2';
				fade_popup($href);
				$href = '#layer4';
				layer_popup3($href);
				event.stopWatching();
			});
		}
		function watchVideo(){
			document.getElementById("screen").src=videoURL;
			setTimeout(function() {
				var $href = '#layer4';
				fade_popup3($href);
				document.getElementById("screen").src="https://raw.githubusercontent.com/iomtcam/iomtcam.github.io/master/black.jpg";
		   },watchTime*1000);
		}

		function camSelected(){
			
			if(document.getElementById("selectCam").value == 'campus'){
				cam1Selected();
			}
			else if(document.getElementById("selectCam").value == 'lab'){
				cam2Selected();
			}
			else{
				camNone();
			}
			 
		}
			
		function cam1Selected(){
		  camAddress='0x45d9c9d461188c3b5261518e42f37a37bbf257d0';
		  camAbi=[
			{
				"constant": true,
				"inputs": [],
				"name": "getBalance",
				"outputs": [
					{
						"name": "",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [
					{
						"name": "",
						"type": "address"
					}
				],
				"name": "payers",
				"outputs": [
					{
						"name": "",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": false,
				"inputs": [
					{
						"name": "_from",
						"type": "address"
					},
					{
						"name": "_value",
						"type": "uint256"
					},
					{
						"name": "_token",
						"type": "address"
					},
					{
						"name": "_extraData",
						"type": "bytes"
					}
				],
				"name": "receiveApproval",
				"outputs": [],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": false,
						"name": "tokenAmount",
						"type": "uint256"
					},
					{
						"indexed": false,
						"name": "second",
						"type": "uint256"
					}
				],
				"name": "calculateTime",
				"type": "event"
			}
		];
		  document.getElementById('videoTime').value = "";
		  document.getElementById('tokenAmount').innerText = "";
		  document.getElementById('imgg2').style.width="0%";
		  document.getElementById('imgg1').style.width="40%";
		  camContract = web3.eth.contract(camAbi);
		  cam = camContract.at(camAddress);
		  event = cam.calculateTime();
		  costPerSecond=0.1;
		  videoURL = "http://117.17.158.187:62000/video.cgi";
		  document.getElementById('tokenPerSecond').innerHTML = costPerSecond;
		  document.getElementById('current').innerHTML = "Campus view";
		  document.getElementById('selectedContent').style.opacity='0';
		  document.getElementById('selectedContent').style.animationName='mainContentAnimation';
		  document.getElementById('selectedContent').style.animationDuration='0.5s';
		  document.getElementById('selectedContent').style.opacity='1';

		}

		function cam2Selected(){
		  camAddress='0x3a42586e04880d5d6e3c4dee2cfaed6fe7d2b4fd';
		  camAbi=[
			{
				"constant": false,
				"inputs": [
					{
						"name": "_from",
						"type": "address"
					},
					{
						"name": "_value",
						"type": "uint256"
					},
					{
						"name": "_token",
						"type": "address"
					},
					{
						"name": "_extraData",
						"type": "bytes"
					}
				],
				"name": "receiveApproval",
				"outputs": [],
				"payable": false,
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": false,
						"name": "tokenAmount",
						"type": "uint256"
					},
					{
						"indexed": false,
						"name": "second",
						"type": "uint256"
					}
				],
				"name": "calculateTime",
				"type": "event"
			},
			{
				"constant": true,
				"inputs": [],
				"name": "getBalance",
				"outputs": [
					{
						"name": "",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			},
			{
				"constant": true,
				"inputs": [
					{
						"name": "",
						"type": "address"
					}
				],
				"name": "payers",
				"outputs": [
					{
						"name": "",
						"type": "uint256"
					}
				],
				"payable": false,
				"stateMutability": "view",
				"type": "function"
			}
		];
		  document.getElementById('videoTime').value = "";
		  document.getElementById('tokenAmount').innerText = "";
		  document.getElementById('imgg1').style.width="0%";
		  document.getElementById('imgg2').style.width="40%";
		  camContract = web3.eth.contract(camAbi);
		  cam = camContract.at(camAddress);
		  event = cam.calculateTime();
		  costPerSecond=0.2;
		  videoURL = "http://117.17.158.187:63000/video.cgi";

		  document.getElementById('tokenPerSecond').innerHTML = costPerSecond;
		  document.getElementById('current').innerHTML = "Lab view";
		  document.getElementById('selectedContent').style.opacity='0';
		  document.getElementById('selectedContent').style.animationName='mainContentAnimation';
		  document.getElementById('selectedContent').style.animationDuration='0.5s';
		  document.getElementById('selectedContent').style.opacity='1';
		}
			
		function camNone(){
		  camAddress="";
		  camAbi="";
		  camContract = "";
		  cam = "";
		  event = "";
		  costPerSecond=1;
		  document.getElementById('tokenPerSecond').innerHTML = "";
		}
		function set(el,text){
		 while(el.firstChild)el.removeChild(el.firstChild);
		 el.appendChild(document.createTextNode(text))}
		 
		/* setupUpdater will be called once, on page load.
		 */
		 
		function setupUpdater(){
		 var input=document.getElementsByTagName('input')[0]
		   , orig=document.getElementById('tokenAmount')
		   , oldText=input.value
		   , timeout=null;
		 
		/* handleChange is called 50ms after the user stops 
		   typing. */
		 function handleChange(){
		  var newText=input.value;
		  if (newText==oldText) return; else oldText=newText;
		  set(orig, (newText*costPerSecond).toFixed(2));
		 }
		 
		/* eventHandler is called on keyboard and mouse events.
		   If there is a pending timeout, it cancels it.
		   It sets a timeout to call handleChange in 50ms. */
		 function eventHandler(){
		  if(timeout) clearTimeout(timeout);
		  timeout=setTimeout(handleChange, 50);
		 }
		 
		 input.onkeydown=input.onkeyup=input.onclick=eventHandler;
		}

    $('.btn-example').click(function(){
		if(document.getElementById('tokenAmount').innerText==""){
		   var $href = '#layer3';
		   layer_popup2($href);
		}
		else if(document.getElementById('tokenAmount').innerText!=""){
			var $href = '#layer2';
			layer_popup($href);
			sendToken();
		}
        
    });
	
    function layer_popup(el){

        var $el = $(el);		//레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg');	//dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer').fadeIn() : $el.fadeIn();

        var $elWidth = ~~($el.outerWidth()),
            $elHeight = ~~($el.outerHeight()),
            docWidth = $(document).width(),
            docHeight = $(document).height();

        // 화면의 중앙에 레이어를 띄운다.
        if ($elHeight < docHeight || $elWidth < docWidth) {
            $el.css({
                marginTop: -$elHeight /2,
                marginLeft: -$elWidth/2
            })
        } else {
            $el.css({top: 0, left: 0});
        }
		
        $el.find('a.btn-layerClose').click(function(){
            isDim ? $('.dim-layer').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
            return false;
        });

        $('.layer .dimBg').click(function(){
            $('.dim-layer').fadeOut();
            return false;
        });

    }
	function layer_popup2(el){

        var $el = $(el);		//레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg2');	//dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer2').fadeIn() : $el.fadeIn();

        var $elWidth = ~~($el.outerWidth()),
            $elHeight = ~~($el.outerHeight()),
            docWidth = $(document).width(),
            docHeight = $(document).height();

        // 화면의 중앙에 레이어를 띄운다.
        if ($elHeight < docHeight || $elWidth < docWidth) {
            $el.css({
                marginTop: -$elHeight /2,
                marginLeft: -$elWidth/2
            })
        } else {
            $el.css({top: 0, left: 0});
        }

        $el.find('a.btn-layerClose2').click(function(){
            isDim ? $('.dim-layer2').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
            return false;
        });

        $('.layer .dimBg2').click(function(){
            $('.dim-layer2').fadeOut();
            return false;
        });

    }
	function layer_popup3(el){

        var $el = $(el);		//레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg3');	//dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer3').fadeIn() : $el.fadeIn();

        var $elWidth = ~~($el.outerWidth()),
            $elHeight = ~~($el.outerHeight()),
            docWidth = $(document).width(),
            docHeight = $(document).height();

        // 화면의 중앙에 레이어를 띄운다.
        if ($elHeight < docHeight || $elWidth < docWidth) {
            $el.css({
                marginTop: -$elHeight /2,
                marginLeft: -$elWidth/2
            })
        } else {
            $el.css({top: 0, left: 0});
        }

        $el.find('a.btn-layerClose3').click(function(){
            isDim ? $('.dim-layer3').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
            return false;
        });

        $('.layer .dimBg3').click(function(){
            $('.dim-layer3').fadeOut();
            return false;
        });

    }
	
	function fade_popup(el){
        var $el = $(el);		//레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg');	//dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.

        $('.dim-layer').fadeOut();
    }
	function fade_popup3(el){
        var $el = $(el);		//레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg3');	//dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer3').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.

        $('.dim-layer3').fadeOut();
    }
	
      //# sourceURL=pen.js
    
	</script>
</html>
